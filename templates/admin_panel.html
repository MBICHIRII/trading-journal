{% extends "layout.html" %}
{% block title %}Admin Panel{% endblock %}

{% block content %}
<h2 class="text-2xl font-bold mb-4">ðŸ‘‘ Admin Panel</h2>

<table class="table-auto w-full border mb-6">
  <thead class="bg-gray-200">
    <tr>
      <th class="px-2 py-1">User ID</th>
      <th class="px-2 py-1">Username</th>
      <th class="px-2 py-1">Role</th>
      <th class="px-2 py-1">Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for u in users %}
    <tr class="border-t">
      <td class="px-2 py-1">{{ u.id }}</td>
      <td class="px-2 py-1">{{ u.username }}</td>
      <td class="px-2 py-1">{{ u.role }}</td>
      <td class="px-2 py-1 space-x-2">
        {% if session.get("user_id") != u.id %}
          <!-- Promote/Demote -->
          <form action="{{ url_for('toggle_role', uid=u.id) }}" method="post" style="display:inline;">
            <button type="submit" class="bg-blue-500 text-white px-2 py-1 rounded text-sm">
              {% if u.role == 'admin' %}Demote{% else %}Promote{% endif %}
            </button>
          </form>

          <!-- Delete -->
          <form action="{{ url_for('delete_user', uid=u.id) }}" method="post" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this user?');">
            <button type="submit" class="bg-red-500 text-white px-2 py-1 rounded text-sm">Delete</button>
          </form>

          <!-- View Activity -->
          <a href="{{ url_for('admin_user_activity', user_id=u.id) }}" class="bg-gray-700 text-white px-2 py-1 rounded text-sm inline-block">
            View Activity
          </a>
        {% else %}
          <em>(you)</em>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
